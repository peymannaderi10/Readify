<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="sidepanel.css" />
        <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body class="sidepanel-body">
        <!-- Header -->
        <header class="sidepanel-header">
            <div class="header-content">
                <div class="logo-section">
                    <img src="logo.png" alt="Readify Logo" class="sidepanel-logo" />
                    <h1 class="sidepanel-title">Readify</h1>
                </div>
            </div>
        </header>

        <!-- Auth Section (collapsible, shown when not logged in) -->
        <section class="control-section auth-control-section" id="authSection" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">üë§ Account</h2>
            </div>
            <div class="auth-buttons">
                <button class="auth-toggle-btn" id="showSigninBtn">Sign In</button>
                <button class="auth-toggle-btn secondary" id="showSignupBtn">Sign Up</button>
            </div>
            
            <!-- Collapsible Forms Container -->
            <div class="auth-forms-container" id="authFormsContainer" style="display: none;">
                <!-- Sign In Form -->
                <div class="auth-form" id="signinForm">
                    <div class="form-group">
                        <label for="signinEmail">Email</label>
                        <input type="email" id="signinEmail" placeholder="you@example.com" />
                    </div>
                    <div class="form-group">
                        <label for="signinPassword">Password</label>
                        <input type="password" id="signinPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                    </div>
                    <button class="auth-submit-btn" id="signinBtn">Sign In</button>
                    <div class="auth-message" id="signinMessage"></div>
                    <button class="forgot-password-btn" id="forgotPasswordBtn">Forgot Password?</button>
                </div>

                <!-- Sign Up Form -->
                <div class="auth-form" id="signupForm" style="display: none;">
                    <div class="form-group">
                        <label for="signupEmail">Email</label>
                        <input type="email" id="signupEmail" placeholder="you@example.com" />
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                    </div>
                    <div class="form-group">
                        <label for="signupConfirmPassword">Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                    </div>
                    <button class="auth-submit-btn" id="signupBtn">Create Account</button>
                    <div class="auth-message" id="signupMessage"></div>
                </div>
            </div>
        </section>


        <!-- Premium Banner (shown for free users) -->
        <section class="premium-banner" id="premiumBanner" style="display: none;">
            <div class="premium-content">
                <span class="premium-icon">‚ú®</span>
                <div class="premium-text">
                    <strong>Upgrade to Premium</strong>
                    <small>Unlimited sites, AI features, cloud sync</small>
                </div>
                <button class="premium-cta" id="premiumCta">$4.99/mo</button>
            </div>
        </section>

        <!-- Main Content -->
        <main class="sidepanel-main">
            <!-- Line Height Controls -->
            <section class="control-section">
                <div class="section-header">
                    <h2 class="section-title">üìè Line Height</h2>
                </div>
                <div class="button-group">
                    <button id="decrease" class="control-button secondary">
                        <span class="button-icon">Aa-</span>
                        <span class="button-label">Decrease</span>
                    </button>
                    <button id="increase" class="control-button primary">
                        <span class="button-icon">Aa+</span>
                        <span class="button-label">Increase</span>
                    </button>
                </div>
            </section>

            <!-- Study Mode Toggle -->
            <section class="control-section">
                <div class="section-header">
                    <h2 class="section-title">üéØ Study Mode</h2>
                </div>
                <div class="toggle-container">
                    <label class="modern-toggle study-toggle" for="enableCheckbox">
                        <input type="checkbox" id="enableCheckbox" />
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">Enable Study Mode</span>
                    </label>
                </div>
            </section>

            <!-- Delete Changes -->
            <section class="control-section">
                <div class="danger-zone">
                    <button id="deleteChangesButton" class="control-button danger" disabled>
                        <span class="button-icon">üóëÔ∏è</span>
                        <span class="button-label">Delete All Changes</span>
                    </button>
                </div>
            </section>

            <!-- My Sites -->
            <section class="control-section">
                <div class="section-header">
                    <h2 class="section-title">üåê My Sites <span class="limit-counter" id="limitCounter">(0/5)</span></h2>
                </div>
                <div class="sites-container">
                    <div class="sites-list" id="sitesList">
                        <div class="empty-sites">
                            <p>No saved sites yet</p>
                            <small>Your highlighted and noted websites will appear here</small>
                        </div>
                    </div>
                </div>
            </section>

            <!-- User Profile Section (always visible when logged in) -->
            <section class="user-profile-section" id="userProfileSection" style="display: none;">
                <div class="user-info">
                    <div class="user-avatar">üë§</div>
                    <div class="user-details">
                        <div class="user-email" id="userEmail">user@example.com</div>
                        <div class="user-plan" id="userPlan">
                            <span class="plan-badge free">Free Plan</span>
                        </div>
                    </div>
                </div>
                <div class="user-actions">
                    <button class="upgrade-btn" id="upgradeBtn" style="display: none;">
                        ‚ú® Upgrade to Premium
                    </button>
                    <button class="cancel-sub-btn" id="cancelSubBtn" style="display: none;">
                        Cancel Subscription
                    </button>
                    <button class="sub-ending-btn" id="subEndingBtn" style="display: none;" disabled>
                        Ends on ...
                    </button>
                    <button class="signout-btn" id="signoutBtn">Sign Out</button>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="sidepanel-footer">
            <div class="footer-links">
                <a href="https://www.readify.ca/faq-s" target="_blank" rel="noopener noreferrer" class="footer-link">FAQ</a>
                <a href="https://www.readify.ca/" target="_blank" rel="noopener noreferrer" class="footer-link">Report Issue</a>
                <a href="https://www.readify.ca/" target="_blank" rel="noopener noreferrer" class="footer-link">Website</a>
            </div>
            <div class="footer-image">
                <img src="thanks.png" alt="Thanks" class="thanks-image" />
            </div>
        </footer>

        <!-- Confirmation Modal -->
        <div class="modal-overlay" id="confirmationModal" style="display: none;">
            <div class="modern-modal">
                <div class="modal-header">
                    <h3 class="modal-title">‚ö†Ô∏è Important Notice</h3>
                </div>
                <div class="modal-body">
                    <p class="modal-text">This action will delete all your saved notes, highlights, and underlines from the current webpage.</p>
                    <p><strong>Note:</strong> This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="control-button secondary" id="cancelBtn">Cancel</button>
                    <button type="button" class="control-button primary" id="confirmBtn">Delete</button>
                </div>
            </div>
        </div>

        <!-- Payment Success Modal -->
        <div class="modal-overlay" id="paymentSuccessModal" style="display: none;">
            <div class="modern-modal success-modal">
                <div class="modal-header">
                    <h3>üéâ Welcome to Premium!</h3>
                </div>
                <div class="modal-body">
                    <p>Your subscription is now active. Enjoy unlimited sites, AI features, and cloud sync!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="control-button primary" id="successOkBtn">Get Started</button>
                </div>
            </div>
        </div>

        <!-- Cancel Subscription Modal -->
        <div class="modal-overlay" id="cancelSubModal" style="display: none;">
            <div class="modern-modal">
                <!-- Confirmation State -->
                <div id="cancelSubConfirmState">
                    <div class="modal-header">
                        <h3 class="modal-title">‚ö†Ô∏è Cancel Subscription</h3>
                    </div>
                    <div class="modal-body">
                        <p class="modal-text">You'll keep Premium access until your billing period ends.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="control-button secondary" id="cancelSubCancelBtn">Keep Premium</button>
                        <button type="button" class="control-button danger" id="cancelSubConfirmBtn">Cancel</button>
                    </div>
                </div>
                <!-- Success State -->
                <div id="cancelSubSuccessState" style="display: none;">
                    <div class="modal-header">
                        <h3 class="modal-title">‚úì Subscription Cancelled</h3>
                    </div>
                    <div class="modal-body">
                        <p class="modal-text" id="cancelSuccessMessage">Your Premium access will end on your billing date.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="control-button primary" id="cancelSubDoneBtn">Done</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Load scripts -->
        <script src="lib/supabase.min.js"></script>
        <script src="config.js"></script>
        <script src="supabase-client.js"></script>
        <script src="auth-service.js"></script>
        <script src="subscription-service.js"></script>
        <script src="storage-service.js"></script>
        <script src="stripe-service.js"></script>
        <script src="sidepanel.js"></script>
    </body>
</html>
